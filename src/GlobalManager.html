<!DOCTYPE html>
<html>
<head>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

	<title>Global Manager</title>

	<link rel="stylesheet"
		  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css"
		  integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ="
		  crossorigin="anonymous" />
	<link rel="stylesheet"
		  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css"
		  integrity="sha256-L/W5Wfqfa0sdBNIKN9cG6QA5F2qx4qICmU2VgLruv9Y="
		  crossorigin="anonymous" />

</head>
<body>

	<div id="root">
		<div class="container">
			<main class="mt-3">
				<div class="alert alert-warning" v-if="isInsecureHttp">
					Caution: Due to visiting through Http without Ssl protection, the global management key is leaked to the internet data link. This page should never be visited though http protocol. Please consider to access this page through Https only and change the global management key asap.
				</div>

				<h1 class="lead text-center">Global Setting</h1>
				<hr />
				<table class="table table-stripped">
					<thead>
						<tr>
							<th>Setting</th>
							<th>Value</th>
							<th>Operation</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<th>Default Target</th>
							<td>
								<div class="form-group">
									<input class="form-control" type="url" v-model="globalSetting.defaultTarget.target" />
								</div>
								<div class="form-group">
									<div class="form-check form-check-inline">
										<label class="form-check-label">
											<input type="checkbox" class="form-check-input" v-model="globalSetting.defaultTarget.permanent" /> Use Http 301
										</label>
									</div>
									<div class="form-check form-check-inline">
										<label class="form-check-label">
											<input type="checkbox" class="form-check-input" v-model="isAttached" />
											<span v-if="globalSetting.defaultTarget.queryProcess === 1">
												Attach (Append Directly)
											</span>
											<span v-else-if="globalSetting.defaultTarget.queryProcess === 2">
												Attach (Removing Leading Question Mark)
											</span>
											<span v-else>
												Attach
											</span>
										</label>
									</div>
								</div>

							</td>

							<td>
								<button type="button" class="btn btn-outline-secondary">Save</button>
							</td>
						</tr>

					</tbody>
				</table>

			</main>
		</div>
	</div>



	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"
			integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
			crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.1/jquery.validate.min.js"
			integrity="sha256-sPB0F50YUDK0otDnsfNHawYmA5M0pjjUf4TvRJkGFrI="
			crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/3.2.11/jquery.validate.unobtrusive.min.js"
			integrity="sha256-9GycpJnliUjJDVDqP0UEu/bsm9U+3dnQUH8+3W10vkY="
			crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"
			integrity="sha256-x3YZWtRjM8bJqf48dFAv/qmgL68SI4jqNWeSLMZaMGA="
			crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/js/bootstrap.min.js"
			integrity="sha256-WqU1JavFxSAMcLP2WIOI+GB2zWmShMI82mTpLDcqFUg="
			crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.10/vue.min.js"
			integrity="sha256-chlNFSVx3TdcQ2Xlw7SvnbLAavAQLO0Y/LBiWX04viY="
			crossorigin="anonymous"></script>

	<script>

		var rootVue = new Vue({
			el: '#root',
			data: {
				globalSetting: {
					defaultTarget: {
						target: null,
						permanent: false,
						queryProcess: false
					}
				},
				messages: []
			},
			computed: {
				isInsecureHttp() {
					return location.protocol !== 'https:';
				},
				isAttached: {
					get() {
						return this.globalSetting.defaultTarget.queryProcess !== 0;
					},
					set(value) {
						if (value) {
							this.globalSetting.defaultTarget.queryProcess = 1;
						} else {
							this.globalSetting.defaultTarget.queryProcess = 0;
						}
					}
				}
			},

			methods: {

				getGlobalSetting() {
					$.get('?verb=GetGlobalSetting',
						function (data) {
							rootVue.globalSetting = data;
						});
				},
				updateGlobalDefaultTarget() {
					// Create data object
					var data = $.param(this.globalSetting.defaultTarget);
					data.queryProcess = data.queryProcess !== 0;

					$.get('?verb=UpdateGlobalDefaultTarget', data);
				}

			},

			created() {
				this.getGlobalSetting();
			}
		});
	</script>


</body>
</html>